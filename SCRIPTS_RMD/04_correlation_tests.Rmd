---
title: "04_prelim_tests"
author: "Trio"
date: "2024-05-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Correlation between positive_lymph_nodes and overall_survival_years in breast cancer deaths
result: weak negative correlation (-0.2177), but statistically significant (p-value = 1.4*10^-7)

```{r}
{plot
(qqnorm(METABRIC_SUBSET$lymph_nodes_examined_positive[METABRIC_SUBSET$overall_survival==1]))
 qqline(METABRIC_SUBSET$lymph_nodes_examined_positive[METABRIC_SUBSET$overall_survival==1], col="red")
}

hist(METABRIC_SUBSET$lymph_nodes_examined_positive[METABRIC_SUBSET$overall_survival==1], prob=TRUE, main="Hystogram of Pos Lymph Nodes")

{plot
(qqnorm(METABRIC_SUBSET$overall_survival_years[METABRIC_SUBSET$overall_survival==1]))
qqline(METABRIC_SUBSET$overall_survival_years[METABRIC_SUBSET$overall_survival==1], col="red")
}

hist(METABRIC_SUBSET$overall_survival_years[METABRIC_SUBSET$overall_survival==1], prob=TRUE, main="Hystogram of OS")

cor.test(METABRIC_SUBSET$lymph_nodes_examined_positive[METABRIC_SUBSET$overall_survival==1], METABRIC_SUBSET$overall_survival_years[METABRIC_SUBSET$overall_survival==1], 
         method="spearman")
```
Correlation between tumor_size and overall_survival_years in breast cancer deaths
result: weak negative correlation (rho= -0.189), but statistically significant (p-value = 5.28*10^-6)

```{r}
{plot
(qqnorm(METABRIC_SUBSET$tumor_size[METABRIC_SUBSET$overall_survival==1]))
qqline(METABRIC_SUBSET$tumor_size[METABRIC_SUBSET$overall_survival==1], col="red")
}

hist(METABRIC_SUBSET$tumor_size[METABRIC_SUBSET$overall_survival==1], prob=TRUE, main="Hystogram of Tumor size")

cor.test(METABRIC_SUBSET$tumor_size[METABRIC_SUBSET$overall_survival==1], METABRIC_SUBSET$overall_survival_years[METABRIC_SUBSET$overall_survival==1], 
         method="spearman")

```
Correlation between age_at_diagnosis and tumor_size in breast cancer deaths
Result: weak positive correlation (rho= 0.104), but statistically significant (p-value = 0.000194)

```{r}
{plot
(qqnorm(METABRIC_SUBSET$age_at_diagnosis))
qqline(METABRIC_SUBSET$age_at_diagnosis, col="red")
}

hist(METABRIC_SUBSET$age_at_diagnosis, prob="TRUE", main="Hystogram of Age at diagnosis")

cor.test(METABRIC_SUBSET$age_at_diagnosis, METABRIC_SUBSET$tumor_size, 
         method="spearman")

```
Correlation between age_at_diagnosis and overall_survival_years in breast cancer deaths
Result: non-significant

```{r}
cor.test(METABRIC_SUBSET$age_at_diagnosis[METABRIC_SUBSET$overall_survival==1], METABRIC_SUBSET$overall_survival_years[METABRIC_SUBSET$overall_survival==1], 
         method="spearman")

```
Correlation between age_at_diagnosis and RFS_years in breast cancer deaths
Result: weak positive correlation (rho= 0.124), but statistically significant (p-value = 0.003)

```{r}
{plot
(qqnorm(METABRIC_SUBSET$RFS_years[METABRIC_SUBSET$overall_survival==1]))
qqline(METABRIC_SUBSET$RFS_years[METABRIC_SUBSET$overall_survival==1], col="red")
}

hist(METABRIC_SUBSET$RFS_years[METABRIC_SUBSET$overall_survival==1], prob="TRUE", main="Hystogram of RFS years")

cor.test(METABRIC_SUBSET$age_at_diagnosis[METABRIC_SUBSET$overall_survival==1], METABRIC_SUBSET$RFS_years[METABRIC_SUBSET$overall_survival==1], 
         method="spearman")
```

Correlation between tumor size and pos lymph nodes considering all the subset dataset
weak positive correlation (rho = 0.34), but statistically significant (p-value < 2.2*10^-16).
It makes more sense using all the patients in this case, considering the absense of variables related to censoring.

```{r}
cor.test(METABRIC_SUBSET$tumor_size, METABRIC_SUBSET$lymph_nodes_examined_positive, 
         method="spearman")
```
Correlation between age and # of positive lymph nodes is non-significant

Correlation using mutation count and TMB are never significant. Specifically, 
TMB is computed from mutation count so beware to correlate with each other

Next step: transformation using logarithms etc to see if we are able to obtain stronger correlations

---------------------------------------------------------------------------------------

ASSOCIATION TESTS

Association between receptor subtypes and histologic grade (p-value < 2.2e-16). 

```{r}
table(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$neoplasm_histologic_grade[METABRIC_SUBSET$receptor_subtype!="NC"])

chisq.test(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$neoplasm_histologic_grade[METABRIC_SUBSET$receptor_subtype!="NC"], correct=FALSE)

grade=table(METABRIC_SUBSET$neoplasm_histologic_grade[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"])

barplot(grade, beside=TRUE, legend=c("Grade 1","Grade 2", "Grade 3"), args.legend=list(x="topleft"), main="Neoplasm Histologic Grade")
```
Association between receptor subtypes and cellularity (p-value = 10^-12). 

```{r}
METABRIC_SUBSET$cellularity <- factor(METABRIC_SUBSET$cellularity, level=c("Low", "Moderate", "High"))

table(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$cellularity[METABRIC_SUBSET$receptor_subtype!="NC"])

chisq.test(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$cellularity[METABRIC_SUBSET$receptor_subtype!="NC"], correct=FALSE)

cellularity=table(METABRIC_SUBSET$cellularity[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"])

barplot(cellularity, beside=TRUE, legend=c("Low", "Moderate", "High"), args.legend=list(x="topleft"), main="Cellularity")


```
Association between receptor subtypes and surgery treatment (p-value = 0.0005246).

```{r}
table(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC" & METABRIC_SUBSET$type_of_breast_surgery!=""], METABRIC_SUBSET$type_of_breast_surgery[METABRIC_SUBSET$receptor_subtype!="NC" & METABRIC_SUBSET$type_of_breast_surgery!=""])

chisq.test(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC" & METABRIC_SUBSET$type_of_breast_surgery!=""], METABRIC_SUBSET$type_of_breast_surgery[METABRIC_SUBSET$receptor_subtype!="NC" & METABRIC_SUBSET$type_of_breast_surgery!=""], correct=FALSE)

surgery=table(METABRIC_SUBSET$type_of_breast_surgery[METABRIC_SUBSET$receptor_subtype!="NC" & METABRIC_SUBSET$type_of_breast_surgery!=""], METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC" & METABRIC_SUBSET$type_of_breast_surgery!=""])

barplot(surgery, beside=TRUE, legend=c("Breast Conserving", "Mastectomy"), args.legend=list(x="topleft"), main="Surgery Treatment")
```
Association between receptor subtypes and tumor size stage (p-value = 1.286e-07).

```{r}
table(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$tumor_size_stage[METABRIC_SUBSET$receptor_subtype!="NC"])

chisq.test(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$tumor_size_stage[METABRIC_SUBSET$receptor_subtype!="NC"], correct=FALSE)

tumor_size=table(METABRIC_SUBSET$tumor_size_stage[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"])

barplot(tumor_size, beside=TRUE, legend=c("T1", "T2", "T3"), args.legend=list(x="topleft"), main="Tumor size")
```
Association between receptor subtypes and number of positive lymph nodes (p-value = 2.464e-05).

```{r}
table(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$pos_lymph_nodes_stage[METABRIC_SUBSET$receptor_subtype!="NC"])

chisq.test(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$pos_lymph_nodes_stage[METABRIC_SUBSET$receptor_subtype!="NC"], correct=FALSE)

pos_lymph_nodes=table(METABRIC_SUBSET$pos_lymph_nodes_stage[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"])

barplot(pos_lymph_nodes, beside=TRUE, legend=c("pN0", "pN1", "pN2", "pN3"), args.legend=list(x="topleft"), main="Number of Positive Lymph Nodes")
```
Association between receptor subtypes and brca1/brca2 mutation (p-value = 0.0005351).

```{r}
table(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$brca_mut[METABRIC_SUBSET$receptor_subtype!="NC"])

chisq.test(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$brca_mut[METABRIC_SUBSET$receptor_subtype!="NC"], correct=FALSE)

brca_mutation=table(METABRIC_SUBSET$brca_mut[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"])

barplot(brca_mutation, beside=TRUE, legend=c("Absent", "Present"), args.legend=list(x="topleft"), main="BRCA1 or BRCA2 mutation")
```
Association between repector subtypes and tp53 mutation (p-value < 2.2e-16). The mutation frequency is higher in the TNBC subtype than the other subtypes. This is in accordance with literature findings.

```{r}
table(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$tp53_mut[METABRIC_SUBSET$receptor_subtype!="NC"])

chisq.test(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$tp53_mut[METABRIC_SUBSET$receptor_subtype!="NC"], correct=FALSE)

tp53_mutation=table(METABRIC_SUBSET$tp53_mut[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"])

barplot(tp53_mutation, beside=TRUE, legend=c("Absent", "Present"), args.legend=list(x="topleft"), main="TP53 mutation")
```
Association between receptor subtypes and NPI (p-value < 2.2e-16).

```{r}
table(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$NPI_stage[METABRIC_SUBSET$receptor_subtype!="NC"])

chisq.test(METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$NPI_stage[METABRIC_SUBSET$receptor_subtype!="NC"], correct=FALSE)

NPI=table(METABRIC_SUBSET$NPI_stage[METABRIC_SUBSET$receptor_subtype!="NC"], METABRIC_SUBSET$receptor_subtype[METABRIC_SUBSET$receptor_subtype!="NC"])

barplot(NPI, beside=TRUE, legend=c("Poor", "Moderate", "Good", "Excellent"), args.legend=list(x="topleft"), main="Nottingham Prognostic Index")
```

---------------------------------------------------------------------------------------

MANN-WHITNEY U TESTS

Investigating differences in gene expressions among receptor subtypes, with LumA used as the reference due to its better prognostic outcomes according to literature findings.


Differential gene expressions between LumA and LumB (9992 out of 20603 null hypotheses rejected)

```{r}
p_val <- c()
for (i in 37:20639) {
  y <- wilcox.test(as.numeric(METABRIC_SUBSET_GENES[i][METABRIC_SUBSET_GENES$receptor_subtype=='LumA',]), 
                   as.numeric(METABRIC_SUBSET_GENES[i][METABRIC_SUBSET_GENES$receptor_subtype=='LumB',]), 
                   paired = FALSE)$p.value
  names(y) <- colnames(METABRIC_SUBSET_GENES[i])
  p_val <- c(p_val, y)
}
p_adj <- p.adjust(p_val, method = "BH")
DE_genes <- p_adj[p_adj<0.05]
num_rejected <- length(DE_genes)
print(num_rejected)
```

Differential gene expressions between LumA and TNBC (12684 out of 20603 null hypotheses rejected)

```{r}
p_val <- c()
for (i in 37:20639) {
  y <- wilcox.test(as.numeric(METABRIC_SUBSET_GENES[i][METABRIC_SUBSET_GENES$receptor_subtype=='LumA',]), 
                   as.numeric(METABRIC_SUBSET_GENES[i][METABRIC_SUBSET_GENES$receptor_subtype=='TNBC',]), 
                   paired = FALSE)$p.value
  names(y) <- colnames(METABRIC_SUBSET_GENES[i])
  p_val <- c(p_val, y)
}
p_adj <- p.adjust(p_val, method = "BH")
DE_genes <- p_adj[p_adj<0.05]
num_rejected <- length(DE_genes)
print(num_rejected)
```

Differential gene expressions between LumA and HER2+ (10564 out of 20603 null hypotheses rejected)

```{r}
p_val <- c()
for (i in 37:20639) {
  y <- wilcox.test(as.numeric(METABRIC_SUBSET_GENES[i][METABRIC_SUBSET_GENES$receptor_subtype=='LumA',]), 
                   as.numeric(METABRIC_SUBSET_GENES[i][METABRIC_SUBSET_GENES$receptor_subtype=='HER2+',]), 
                   paired = FALSE)$p.value
  names(y) <- colnames(METABRIC_SUBSET_GENES[i])
  p_val <- c(p_val, y)
}
p_adj <- p.adjust(p_val, method = "BH")
DE_genes <- p_adj[p_adj<0.05]
num_rejected <- length(DE_genes)
print(num_rejected)
```

